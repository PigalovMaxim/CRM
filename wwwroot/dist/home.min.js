const container=document.getElementById("js-home-container"),widgetList=document.getElementById("js-home-widget-modal-list"),modal=document.getElementById("js-home-modal"),closeModal=document.getElementById("js-home-close-modal"),WIDGETS_STYLES=["w-3/10 h-home-widget-height","w-3/10 h-home-widget-height"],DAYS_COLORS=["bg-c-green","bg-c-red","bg-yellow-500","bg-purple-500","bg-gray-400"],LOADING_CLASSNAMES="w-full h-full flex flex-col justify-center items-center",MAIN_CLASSNAMES="w-full flex flex-row flex-wrap justify-start items-start";async function setWidgetList(){try{var e=window.location.origin,t=await fetch(e+"/api/home/getWidgetList");result=await t.json(),widgetList.innerHTML="",result.forEach(t=>{var e=document.createElement("div"),i=(e.classList="w-full h-10 flex flex-row justify-between items-center mb-2",document.createElement("span")),s=(i.classList="text-lg text-white",i.innerHTML=t.widgetName,document.createElement("button"));s.classList="h-full aspect-square rounded-full text-3xl bg-c-green disabled:opacity-50 hover:bg-c-green-light text-white flex justify-center items-center",s.innerHTML="+",Store.getItem("widgetIds");s.addEventListener("click",()=>{let e=Store.getItem("widgetIds");e.includes(t.widgetId)?e=e.filter(e=>e!==t.widgetId):e.push(t.widgetId),Store.setItem("widgetIds",e),init()}),e.appendChild(i),e.appendChild(s),widgetList.appendChild(e)})}catch(e){console.error("Ошибка сервера",e)}}async function init(){setLoading();let e=[];try{var t=window.location.origin,i=Store.getItem("user").id,s=Store.getItem("widgetIds"),n=await fetch(t+"/api/home/getWidgets",{method:"POST",body:JSON.stringify({id:i,widgetIds:s}),headers:{"Content-Type":"application/json"}});e=await n.json()}catch(e){return void console.error("Ошибка сервера")}container.classList=MAIN_CLASSNAMES,container.innerHTML="",e.length?(e.forEach(e=>{container.appendChild(new Widget(e.typeId,e).render())}),(t=document.createElement("button")).classList="w-3/10 h-home-widget-height p-gap cursor-pointer",(i=document.createElement("div")).classList="hover:bg-block-highlighted/20 transition-colors w-full h-full border-2 border-dashed border-white/40 rounded-lg flex justify-center items-center",i.innerHTML='<img alt="add widget" src="/imgs/plus.png" className="w-40 h-40 opacity-40" />',t.appendChild(i),t.addEventListener("click",()=>modal.classList.remove("hidden")),container.appendChild(t)):(container.classList.add("h-full","flex","flex-col","justify-center","items-center"),(s=document.createElement("h1")).classList="text-4xl text-white mb-4 font-bold",s.innerHTML="У вас нет виджетов",container.appendChild(s),(n=document.createElement("button")).classList="w-60 h-10 bg-c-green hover:bg-c-green-light transition-colors text-white rounded-md flex justify-center items-center",n.innerHTML="Добавить",n.addEventListener("click",()=>modal.classList.remove("hidden")),container.appendChild(n))}function setLoading(){container.classList=LOADING_CLASSNAMES,container.innerHTML='<img src="/imgs/loading.png" alt="loading" class="w-5 h-5 animate-spin" />'}Store.getItem("widgetIds")||Store.setItem("widgetIds",[0,1]),closeModal.addEventListener("click",()=>{modal.classList.add("hidden")}),init(),setWidgetList();class Widget{constructor(e,t){this.type=e,this.data=t,this.classNames=WIDGETS_STYLES[e]}getWidgetName(){var e=document.createElement("div"),t=(e.classList="bg-block w-full h-full rounded-lg flex flex-col justify-start items-center p-8",document.createElement("h2"));return t.classList="text-2xl text-white font-medium",t.innerHTML=this.data.name,e.appendChild(t),e}getWorkingWidget(){var e=this.getWidgetName(),t=getCircularProgress(300,"#01953F",30,this.data.totalHours/this.data.planHours*100,`${this.data.totalHours}ч / ${this.data.planHours}ч`),i=document.createElement("div");return i.classList="w-full aspect-square mt-4 flex justify-center items-center",i.appendChild(t),e.appendChild(i),e}getDaysWidget(){var e=this.getWidgetName();const s=document.createElement("div");s.classList="w-full grid gap-gap grid-cols-7 mt-10";var t=moment().startOf("month").day();for(let e=0;e<t-1;e++){var i=document.createElement("div");i.classList="aspect-square flex justify-start items-start text-white px-1",s.appendChild(i)}return this.data.days.forEach((e,t)=>{var i=document.createElement("div");i.classList="aspect-square flex justify-start items-start text-white px-1",i.classList.add(DAYS_COLORS[e]),moment().date()===t+1&&i.classList.add("border-2","border-white"),i.innerHTML=t+1,s.appendChild(i)}),e.appendChild(s),e}getLayout(t){var e=document.createElement("div"),i=(e.classList.add("relative","p-gap"),e.classList.add(...this.classNames.split(" ")),document.createElement("button"));return i.classList="transition-colors text-white rounded-md flex justify-center items-center absolute right-4 top-4 w-7 h-7",i.innerHTML='<img src="/imgs/plus.png" alt="cross" class="w-6 h-6 rotate-45" />',i.addEventListener("click",()=>{var e=Store.getItem("widgetIds").filter(e=>e!==t);Store.setItem("widgetIds",e),init()}),e.appendChild(i),e}render(){let e=null;switch(this.type){case 0:return(e=this.getLayout(this.type)).appendChild(this.getWorkingWidget()),e;case 1:return(e=this.getLayout(this.type)).appendChild(this.getDaysWidget()),e;default:return this.getLayout(-1)}}}function getCircularProgress(e,t,i,s,n){var a=document.createElement("canvas"),d=(a.style.width=e+"px",a.style.height=e+"px",a.width=e,a.height=e,document.body.appendChild(a),a.getContext("2d")),r=-.5*Math.PI,s=2*Math.PI*s/100+r;return d.beginPath(),d.arc(e/2,e/2,e/2-i,r,s),d.lineWidth=i,d.strokeStyle=t,d.stroke(),d.beginPath(),d.arc(e/2,e/2,e/2-i,r,2*Math.PI+r),d.strokeStyle=t+"50",d.stroke(),d.fillStyle="#ffffff",d.font="32px Arial",d.textAlign="center",d.textBaseline="middle",d.fillText(n,a.width/2,a.height/2),a}