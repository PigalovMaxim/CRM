const container=document.getElementById("js-home-container"),WIDGETS_STYLES=["w-3/10 h-home-widget-height","w-3/10 h-home-widget-height"],DAYS_COLORS=["bg-c-green","bg-c-red","bg-yellow-500","bg-purple-500","bg-gray-400"],LOADING_CLASSNAMES="w-full h-full flex flex-col justify-center items-center",MAIN_CLASSNAMES="w-full flex flex-row flex-wrap justify-start items-start";async function init(){setLoading();var t=window.location.origin;let e=[];var i=Store.getItem("user").id;try{var a=await fetch(t+"/api/home/getWidgets?id="+i);e=await a.json()}catch(t){return void console.error("Ошибка сервера")}container.classList=MAIN_CLASSNAMES,container.innerHTML="",e.length?(e.forEach(t=>{container.appendChild(new Widget(t.typeId,t).render())}),(t=document.createElement("button")).classList="w-3/10 h-home-widget-height p-gap cursor-pointer",(i=document.createElement("div")).classList="hover:bg-block-highlighted/20 transition-colors w-full h-full border-2 border-dashed border-white/40 rounded-lg flex justify-center items-center",i.innerHTML='<img alt="add widget" src="/imgs/plus.png" className="w-40 h-40 opacity-40" />',t.appendChild(i),container.appendChild(t)):((a=document.createElement("h1")).classList="text-4xl text-white mb-4 font-bold",a.innerHTML="У вас нет виджетов",container.appendChild(a),(i=document.createElement("button")).classList="w-60 h-10 bg-c-green hover:bg-c-green-light transition-colors text-white rounded-md flex justify-center items-center",i.innerHTML="Добавить",container.appendChild(i))}function setLoading(){container.classList=LOADING_CLASSNAMES,container.innerHTML='<img src="/imgs/loading.png" alt="loading" class="w-5 h-5 animate-spin" />'}init();class Widget{constructor(t,e){this.type=t,this.data=e,this.classNames=WIDGETS_STYLES[t]}getWidgetName(){var t=document.createElement("div"),e=(t.classList="bg-block w-full h-full rounded-lg flex flex-col justify-start items-center p-8",document.createElement("h2"));return e.classList="text-2xl text-white font-medium",e.innerHTML=this.data.name,t.appendChild(e),t}getWorkingWidget(){var t=this.getWidgetName(),e=getCircularProgress(300,"#01953F",30,this.data.totalHours/this.data.planHours*100,`${this.data.totalHours}ч / ${this.data.planHours}ч`),i=document.createElement("div");return i.classList="w-full aspect-square mt-4 flex justify-center items-center",i.appendChild(e),t.appendChild(i),t}getDaysWidget(){var t=this.getWidgetName();const a=document.createElement("div");a.classList="w-full grid gap-gap grid-cols-7 mt-10";var e=moment().startOf("month").day();for(let t=0;t<e-1;t++){var i=document.createElement("div");i.classList="aspect-square flex justify-start items-start text-white px-1",a.appendChild(i)}return this.data.days.forEach((t,e)=>{var i=document.createElement("div");i.classList="aspect-square flex justify-start items-start text-white px-1",i.classList.add(DAYS_COLORS[t]),moment().date()===e+1&&i.classList.add("border-2","border-white"),i.innerHTML=e+1,a.appendChild(i)}),t.appendChild(a),t}getLayout(){var t=document.createElement("div"),e=(t.classList.add("relative","p-gap"),t.classList.add(...this.classNames.split(" ")),document.createElement("button"));return e.classList="transition-colors text-white rounded-md flex justify-center items-center absolute right-4 top-4 w-7 h-7",e.innerHTML='<img src="/imgs/plus.png" alt="cross" class="w-6 h-6 rotate-45" />',t.appendChild(e),t}render(){var t=this.getLayout();switch(this.type){case 0:return t.appendChild(this.getWorkingWidget()),t;case 1:return t.appendChild(this.getDaysWidget()),t;default:return t}}}function getCircularProgress(t,e,i,a,s){var n=document.createElement("canvas"),r=(n.style.width=t+"px",n.style.height=t+"px",n.width=t,n.height=t,document.body.appendChild(n),n.getContext("2d")),l=-.5*Math.PI,a=2*Math.PI*a/100+l;return r.beginPath(),r.arc(t/2,t/2,t/2-i,l,a),r.lineWidth=i,r.strokeStyle=e,r.stroke(),r.beginPath(),r.arc(t/2,t/2,t/2-i,l,2*Math.PI+l),r.strokeStyle=e+"50",r.stroke(),r.fillStyle="#ffffff",r.font="32px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText(s,n.width/2,n.height/2),n}