const usersSelect=document.getElementById("js-admin-users"),workDaysContainer=document.getElementById("js-admin-work-days"),createUserBtn=document.getElementById("js-admin-create-user"),createUserLogin=document.getElementById("js-admin-user-login"),createUserPassword=document.getElementById("js-admin-user-password"),createWorkDayDay=document.getElementById("js-admin-workday-day"),createWorkDayCount=document.getElementById("js-admin-workday-count"),createWorkDayDescription=document.getElementById("js-admin-workday-description"),createWorkDayButton=document.getElementById("js-admin-workday-button");let selectedUserId=null;async function createWorkDay(){let e=null;try{var t=window.location.origin,r=await fetch(t+"/api/Admin/CreateWorkDay",{method:"POST",body:JSON.stringify({day:createWorkDayDay.value,count:createWorkDayCount.value,description:createWorkDayDescription.value,userId:selectedUserId}),headers:{"Content-Type":"application/json"}});e=await r.json()}catch(e){return void console.error("Ошибка сервера",e)}if(e)return createWorkDayDay.value="",createWorkDayCount.value="",createWorkDayDescription.value="",init();console.error("Ошибка создания рабочего дня")}async function init(){let e=null;try{var t=window.location.origin,r=selectedUserId?"?id="+selectedUserId:"",n=await fetch(t+"/api/Admin/GetAdminData"+r);e=await n.json()}catch(e){return void console.error("Ошибка сервера")}fillPage(e)}function fillPage(e){fillUsers(e),fillWorkDays(e)}function fillUsers(e){let r=usersSelect.innerHTML="";selectedUserId=selectedUserId||e.users[0].id,e.users.forEach(e=>{var t=selectedUserId===e.id;r+=`<option class="bg-block" ${t?"selected":""} value="${e.id}">${e.login}</option>`}),usersSelect.innerHTML=r}function fillWorkDays(e){Array.from(workDaysContainer.children).forEach(e=>{e.classList.contains("js-not-delete")||e.remove()}),e.workDays.forEach((e,t)=>{var r=document.createElement("tr"),n=(r.classList=`px-4 h-14 ${t%2==1?"bg-block":""} text-white`,document.createElement("td")),t=(n.classList.add("px-2"),n.innerHTML=t+1,r.appendChild(n),document.createElement("td"));t.classList.add("px-2");n=new Date(e.day).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),t.innerHTML=n,r.appendChild(t),n=document.createElement("td"),n.classList.add("px-2"),n.innerHTML=e.count,r.appendChild(n),t=document.createElement("td");t.classList.add("px-2"),t.innerHTML=e.description,r.appendChild(t),workDaysContainer.prepend(r)})}init(),usersSelect.addEventListener("change",e=>{selectedUserId=parseInt(e.target.value),init()}),createWorkDayButton.addEventListener("click",createWorkDay),createUserBtn.addEventListener("click",async()=>{let e=null;try{var t=window.location.origin,r=await fetch(t+"/api/Admin/CreateUser",{method:"POST",body:JSON.stringify({login:createUserLogin.value,hash:MD5(createUserLogin.value+createUserPassword.value)}),headers:{"Content-Type":"application/json"}});e=await r.json()}catch(e){return void console.error("Ошибка сервера")}if(e)return createUserLogin.value="",createUserPassword.value="",init();console.error("Ошибка создания пользователя")});