const usersSelect=document.getElementById("js-admin-users"),workDaysContainer=document.getElementById("js-admin-work-days"),createUserBtn=document.getElementById("js-admin-create-user"),createUserLogin=document.getElementById("js-admin-user-login"),createUserPassword=document.getElementById("js-admin-user-password"),createTaskBtn=document.getElementById("js-admin-create-task"),createTaskTitle=document.getElementById("js-admin-task-title"),createTaskHours=document.getElementById("js-admin-task-hours"),createTaskDescription=document.getElementById("js-admin-task-description"),createWorkDayDay=document.getElementById("js-admin-workday-day"),createWorkDayCount=document.getElementById("js-admin-workday-count"),createWorkDayDescription=document.getElementById("js-admin-workday-description"),createWorkDayButton=document.getElementById("js-admin-workday-button");let selectedUserId=null;async function createWorkDay(){let e=null;try{var t=window.location.origin,a=await fetch(t+"/api/Admin/CreateWorkDay",{method:"POST",body:JSON.stringify({day:createWorkDayDay.value,count:createWorkDayCount.value,description:createWorkDayDescription.value,userId:selectedUserId}),headers:{"Content-Type":"application/json"}});e=await a.json()}catch(e){return void console.error("Ошибка сервера",e)}if(e)return createWorkDayDay.value="",createWorkDayCount.value="",createWorkDayDescription.value="",init();console.error("Ошибка создания рабочего дня")}async function init(){let e=null;try{var t=window.location.origin,a=selectedUserId?"?id="+selectedUserId:"",r=await fetch(t+"/api/Admin/GetAdminData"+a);e=await r.json()}catch(e){return void console.error("Ошибка сервера")}fillPage(e)}function fillPage(e){fillUsers(e),fillWorkDays(e)}function fillUsers(e){let a=usersSelect.innerHTML="";selectedUserId=selectedUserId||e.users[0].id,e.users.forEach(e=>{var t=selectedUserId===e.id;a+=`<option class="bg-block" ${t?"selected":""} value="${e.id}">${e.login}</option>`}),usersSelect.innerHTML=a}function fillWorkDays(e){Array.from(workDaysContainer.children).forEach(e=>{e.classList.contains("js-not-delete")||e.remove()}),e.workDays.forEach((e,t)=>{var a=document.createElement("tr"),r=(a.classList=`px-4 h-14 ${t%2==1?"bg-block":""} text-white`,document.createElement("td")),t=(r.classList.add("px-2"),r.innerHTML=t+1,a.appendChild(r),document.createElement("td"));t.classList.add("px-2");r=new Date(e.day).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),t.innerHTML=r,a.appendChild(t),r=document.createElement("td"),r.classList.add("px-2"),r.innerHTML=e.count,a.appendChild(r),t=document.createElement("td");t.classList.add("px-2"),t.innerHTML=e.description,a.appendChild(t),workDaysContainer.prepend(a)})}init(),usersSelect.addEventListener("change",e=>{selectedUserId=parseInt(e.target.value),init()}),createWorkDayButton.addEventListener("click",createWorkDay),createTaskBtn.addEventListener("click",async()=>{let e=null;try{var t=window.location.origin,a=Store.getItem("user"),r=await fetch(t+"/api/Admin/CreateTask",{method:"POST",body:JSON.stringify({title:createTaskTitle.value,description:createTaskDescription.value,hours:createTaskHours.value,wastedHours:0,creatorId:a.id}),headers:{"Content-Type":"application/json"}});e=await r.json()}catch(e){return void console.error("Ошибка сервера")}e&&(createTaskTitle.value="",createTaskHours.value="",createTaskDescription.value=""),console.error("Ошибка создания пользователя")}),createUserBtn.addEventListener("click",async()=>{let e=null;try{var t=window.location.origin,a=await fetch(t+"/api/Admin/CreateUser",{method:"POST",body:JSON.stringify({login:createUserLogin.value,hash:MD5(createUserLogin.value+createUserPassword.value)}),headers:{"Content-Type":"application/json"}});e=await a.json()}catch(e){return void console.error("Ошибка сервера")}if(e)return createUserLogin.value="",createUserPassword.value="",init();console.error("Ошибка создания пользователя")});